-- Estrutura para todas as tabelas, compat√≠vel com H2

CREATE TABLE SPRING_SESSION (
    PRIMARY_ID CHAR(36) NOT NULL,
    SESSION_ID CHAR(36) NOT NULL,
    CREATION_TIME BIGINT NOT NULL,
    LAST_ACCESS_TIME BIGINT NOT NULL,
    MAX_INACTIVE_INTERVAL INT NOT NULL,
    EXPIRY_TIME BIGINT NOT NULL,
    PRINCIPAL_NAME VARCHAR(100),
    CONSTRAINT SPRING_SESSION_PK PRIMARY KEY (PRIMARY_ID)
);

CREATE UNIQUE INDEX SPRING_SESSION_IX1 ON SPRING_SESSION (SESSION_ID);
CREATE INDEX SPRING_SESSION_IX2 ON SPRING_SESSION (EXPIRY_TIME);
CREATE INDEX SPRING_SESSION_IX3 ON SPRING_SESSION (PRINCIPAL_NAME);

CREATE TABLE SPRING_SESSION_ATTRIBUTES (
    SESSION_PRIMARY_ID CHAR(36) NOT NULL,
    ATTRIBUTE_NAME VARCHAR(200) NOT NULL,
    ATTRIBUTE_BYTES BLOB NOT NULL,
    CONSTRAINT SPRING_SESSION_ATTRIBUTES_PK PRIMARY KEY (SESSION_PRIMARY_ID, ATTRIBUTE_NAME),
    CONSTRAINT SPRING_SESSION_ATTRIBUTES_FK FOREIGN KEY (SESSION_PRIMARY_ID) REFERENCES SPRING_SESSION(PRIMARY_ID) ON DELETE CASCADE
);

CREATE TABLE tb_cliente (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  ativo BOOLEAN NOT NULL,
  cpf VARCHAR(255) NOT NULL,
  data_nascimento DATE NOT NULL,
  email VARCHAR(255) NOT NULL,
  email_secundario VARCHAR(255) NOT NULL,
  genero VARCHAR(255) NOT NULL,
  grupo VARCHAR(255),
  nome_completo VARCHAR(255) NOT NULL,
  senha VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
);

CREATE TABLE tb_produto (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  ativo BOOLEAN NOT NULL,
  avaliacao DECIMAL(2,1) NOT NULL,
  categoria TINYINT NOT NULL,
  descricao_detalhada VARCHAR(2000) NOT NULL,
  distribuidor VARCHAR(255) NOT NULL,
  img_url VARCHAR(255) NOT NULL,
  nome VARCHAR(200) NOT NULL,
  parcelas TINYINT NOT NULL,
  preco DECIMAL(12,2) NOT NULL,
  preco_com_desconto DECIMAL(38,2),
  quantidade_em_estoque INT NOT NULL,
  tem_desconto BOOLEAN NOT NULL,
  imagem_base64 CLOB,
  PRIMARY KEY (id)
);

CREATE TABLE tb_imagem_produto (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  diretorio VARCHAR(255) NOT NULL,
  nome_imagem VARCHAR(255) NOT NULL,
  principal BOOLEAN NOT NULL,
  produto_id BIGINT,
  imagem_base64 CLOB,
  PRIMARY KEY (id),
  FOREIGN KEY (produto_id) REFERENCES tb_produto(id)
);

CREATE TABLE tb_pedido (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  cliente_id BIGINT NOT NULL,
  data_pedido TIMESTAMP(6) NOT NULL,
  forma_pagamento VARCHAR(255),
  status VARCHAR(255),
  valor_total DECIMAL(38,2) NOT NULL,
  email_entrega VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
);

CREATE TABLE tb_item_pedido (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  nome_produto VARCHAR(255) NOT NULL,
  produto_id BIGINT NOT NULL,
  quantidade INT NOT NULL,
  valor_unitario DECIMAL(38,2) NOT NULL,
  pedido_id BIGINT,
  PRIMARY KEY (id),
  FOREIGN KEY (pedido_id) REFERENCES tb_pedido(id)
);

CREATE TABLE tb_usuario (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  ativo BOOLEAN NOT NULL,
  cpf VARCHAR(11) NOT NULL,
  email VARCHAR(100) NOT NULL UNIQUE,
  grupo VARCHAR(255) NOT NULL,
  nome VARCHAR(100) NOT NULL,
  senha VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
);